<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<!-- IMPORTS for custom elements etc -->
<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="shared-styles.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-input/paper-textarea.html">
<link rel="import" href="../bower_components/iron-list/iron-list.html">
<link ref="import" href="../bower_components/polymerfire/polymerfire.html">
<link rel="import" href="../bower_components/polymerfire/firebase-query.html">
<link rel="import" href="../bower_components/polymerfire/firebase-document.html">

<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-toast/paper-toast.html">

<!-- Start Element -->
<dom-module id="my-view1">
  <template>
    <style include="shared-styles">
      :host {
        display: block;
        padding: 10px;
      }
      /* Custom css for tag - TO replace with <tag> custom element! */
      .tag {
        padding: 3px 5px;
        margin: 4px 5px;
        border: 1px grey solid;
        border-radius: 4px;
        background-color: #e8ede8;
        display: inline-block;
      }

      .card.half {
        width: 30%;
        display: inline-block;
      }
    </style>

    <!-- Main comment input -->
    <div class="card">
      <h1>Data Session Comments</h1>
      <paper-textarea label="Add a comment" value="{{comment.text}}"></paper-textarea>
      <paper-toast id="submittedText" text="Thank you for your comment. It has been submitted and the outputs will shortly change to include your views."></paper-toast>
    </div>

    <!-- Tag list -->
    <template id='tagRepeat' is='dom-repeat' items='[[tags]]' as='tag'>
      <span class='tag'>[[tag.$val]]</span>
  </template>
  <hr/>
  <!-- Add Tag input -->
  <div class="card half">
    <paper-input
      id="newTagInput"
      label="Add new tag"
      always-float-label
      value="{{newTag}}"
      on-keydown="checkForEnter"
      auto-validate=true
      maxlength=25
    ></paper-input>
    <paper-button raised on-tap="addTag">Add</paper-button>

  </div>

<!-- Submit Comment Button -->
  <div class="card half">
    <paper-button raised on-tap="addComment">Submit Comment</paper-button>
<!-- Query to pull list of tags from database -->
<firebase-query
  id = "tagQuery"
  app-name = "firebaseApp"
  path = "/tags"
  data = "{{tags}}"
  ></firebase-query>

<!-- Document to add new tag to database -->
<firebase-document
  id = "tagDoc"
  app-name = "firebaseApp"
  data = "{{newTag}}"
  ></firebase-document>

<!-- Document to add new comment to database -->
<firebase-document
  id = "commentDoc"
  app-name = "firebaseApp"
  data = "{{comment}}"
></firebase-document>

</template>

<!-- Scripts for element -->
  <script>
    Polymer({
      is: 'my-view1',

      properties: {
        tags:{
          type: Array
        },
        newTag: {
          type: String,
        },
        comment: {
          type: Object,
        },

      },

      // Dummy data initialise.
      ready: function() {
        // this.tags = ["data policy","another tag","data loops","quality","another tag again"]
        console.log(this.tags);
      },

      addTag: function() {
        console.log(this.newTag)
        path = "/tags";
        this.$.tagDoc.save(path).then(function() {
          this.$.tagRepeat.render();
          this.$.tagDoc.reset();
          this.newTag = "";
        }.bind(this));
      },

      addComment: function() {
        console.log(this.comment.text);
        path = "/comments";
        this.$.commentDoc.save(path).then(function() {
          this.$.commentDoc.reset();
          this.comment = {};
          this.$.submittedText.open()
        }.bind(this))
      },


      checkForEnter: function(e) {
        if(e.keyCode === 13) {
          this.addTag();

        }
      }

    });
  </script>
</dom-module>
