<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<!-- IMPORTS for custom elements etc -->
<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="shared-styles.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-input/paper-textarea.html">
<link rel="import" href="../bower_components/iron-list/iron-list.html">
<link ref="import" href="../bower_components/polymerfire/polymerfire.html">
<link rel="import" href="../bower_components/polymerfire/firebase-query.html">
<link rel="import" href="../bower_components/polymerfire/firebase-document.html">

<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-toast/paper-toast.html">
<link rel="import" href="../bower_components/iron-selector/iron-selector.html">

<!-- Start Element -->
<dom-module id="my-view1">
  <template>
    <style include="shared-styles">
      :host {
        display: block;
        padding: 10px;
      }
      /* Custom css for tag - TO replace with <tag> custom element! */
      .tag {
        padding: 3px 5px;
        margin: 4px 5px;
        border: 1px grey solid;
        border-radius: 4px;
        background-color: #e8ede8;
        display: inline-block;
      }
      .selectedTag {
        background-color: rgb(52, 152, 48);
        border: 1px green solid;
      }

      .card.half {
        width: 30%;
        display: inline-block;
      }
      .submit {
        background-color: rgb(33, 110, 14);
        color: white;
        clear: both;
      }

      .Blue {
        background-color: blue!important;
        color: white;
      }
      .Green {
        background-color: green!important;
        color: white;
      }
      .Red {
        background-color: red!important;
        color: white;
      }

      /*paper-toast {
        bottom: 0;
        left: 0;
        width: 100%;
      }*/
    </style>

    <!-- Main comment input -->
    <div class="card" id="commentCard">
      <h1>Data Session Comments</h1>
      <h5>1. Add a personal comment into the pot:</h5>
      <paper-textarea label="Add a comment" always-float-label value="{{comment.text}}"></paper-textarea>

      <h5>2. Tag your comment:</h5>
    <!-- Tag list -->
    <iron-selector
      multi=true
      selected-values="{{comment.tags}}"
      selected-class="selectedTag"
      attr-for-selected="name">

    <template id='tagRepeat' is='dom-repeat' items='[[tags]]' as='tag'>
      <div class='tag' name="[[tag.$val]]">[[tag.$val]]</div>
  </template>
</iron-selector>

  <!-- Submit Comment Button -->

  <br/><br/>
  <paper-button raised on-tap="addComment" class$="[[group]]">
    Submit Your Comment
  </paper-button>
  <paper-toast id="submittedText" text="Comment submitted"></paper-toast>


<!-- end card -->
</div>

<div class="card">
<h2>Add A New Tag?</h2>
<p>If you feel your comment has an important word or key phrase that isn't in the tags, please add it here. It will become available immediately for you (and everyone else!) to use.</p>
  <!-- Add Tag input -->

    <paper-input
      id="newTagInput"
      label="Add new tag"
      always-float-label
      value="{{newTag}}"
      on-keydown="checkForEnter"
      auto-validate=true
      maxlength=25
    ></paper-input>
    <paper-button raised on-tap="addTag" class$="[[group]]">
      Add
      <paper-toast id="submittedTag" text="Tag Added"></paper-toast>
    </paper-button>

  </div>

  <firebase-app
    api-key = "AIzaSyB5vfLVAmDneX7hDZ-N6xGBi1mxB-So0JY"
    auth-domain = "wordcloud-app.firebaseapp.com"
    database-url = "https://wordcloud-app.firebaseio.com"
    id = "firebaseApp2"
    name = "firebaseApp2"
    ></firebase-app>

    <firebase-auth
      id="firebaseAuth2"
      signed-in="{{signedIn}}"
      user="{{user}}"
      app-name="firebaseApp2"
      ></firebase-auth>
<!-- Query to pull list of tags from database -->
<firebase-query
  id = "tagQuery"
  path = "/tags"
  data = "{{tags}}"
  app-name="firebaseApp2"
  ></firebase-query>

<!-- Document to add new tag to database -->
<firebase-document
  id = "tagDoc"
  data = "{{newTag}}"
  app-name="firebaseApp2"

  ></firebase-document>

<!-- Document to add new comment to database -->
<firebase-document
  id = "commentDoc"
  app-name = "firebaseApp2"
  data = "{{comment}}"
></firebase-document>



</template>

<!-- Scripts for element -->
  <script>
    Polymer({
      is: 'my-view1',

      properties: {
        tags:{
          type: Array
        },
        newTag: {
          type: String,
        },
        comment: {
          type: Object,
        },
        group: {
          type: String,
        }

        // selectedTags: {
        //   type: Array,
        //   notify: true,
        // }

      },

      observers: [
        'selectedTagsChanged(comment.tags.*)',
        'newGroup(group)'
      ],

      newGroup: function() {
        this.set('comment.group',this.group);
        console.log(this.comment);
      },
      // Dummy data initialise.
      ready: function() {
        // this.tags = ["data policy","another tag","data loops","quality","another tag again"]
        console.log(this.tags);
        this.$.firebaseAuth2.signInWithEmailAndPassword("demo@demo.demo", "demodemo")
        this.$.submittedTag.fitInto = this.$.commentCard;
        this.$.submittedText.fitInto = this;


      },

      addTag: function() {
        console.log(this.newTag)
        if(this.newTag && this.newTag!="") {
          path = "/tags";
          this.$.tagDoc.save(path, this.newTag).then(function() {
            this.$.tagRepeat.render();
            this.$.tagDoc.reset();
            this.newTag = "";
            this.$.submittedTag.open();
          }.bind(this));
        }
      },

      addComment: function() {
        console.log(this.comment.text);
        if(this.comment.text && this.comment.text!=""){
          this.comment.timestamp = Date.now()
          console.log(this.comment)
          path = "/comments";
          this.$.commentDoc.save(path).then(function() {
            this.$.commentDoc.reset();
            this.comment = {};
            this.$.submittedText.open();
          }.bind(this))
        }
      },


      checkForEnter: function(e) {
        if(e.keyCode === 13) {
          this.addTag();

        }
      },

      selectedTagsChanged: function() {
        console.log(this.comment);
      },

      tagDone: function() {
        console.log(this.tags)
      }

    });
  </script>
</dom-module>
